set daemon 30
set log /var/log/monit
set idfile /var/monit/id
set statefile /var/monit/state

set alert root@blip.town

set mailserver localhost

set httpd port 2812 readonly
	allow localhost
	unixsocket /var/run/monit.sock

check host blip.town with address blip.town
	if failed port 22 protocol ssh for 3 cycles then alert
	if failed port 80 protocol http for 3 cycles then alert
	if failed port 443 protocol https for 3 cycles then alert

check host rnkn.xyz with address rnkn.xyz
	if failed port 80 protocol http for 3 cycles then alert
	if failed port 443 protocol https for 3 cycles then alert

check process bliptown pidfile /tmp/bliptown.pid
	if not exist for 3 cycles then alert

check process bliptown_helper matching "perl /usr/local/www/bliptown/script/bliptown_helper"
	start program = "/usr/sbin/rcctl start bliptown_helper"
	if not exist for 3 cycles then alert
	if not exist for 3 cycles then start

check process sshd pidfile /var/run/sshd.pid
	if not exist for 3 cycles then alert

check process relayd matching "/usr/sbin/relayd"
	if not exist for 3 cycles then alert

check process httpd matching "/usr/sbin/httpd"
	if not exist for 3 cycles then alert

check file doas.conf path /etc/doas.conf
	if failed uid 0 then alert
	if failed gid 0 then alert
	if failed perm 0600 then alert
	if failed md5 checksum expect cab8df0c860ce5696aeb4c9dac59ac7f then alert

check file master.passwd path /etc/master.passwd
	if failed uid 0 then alert
	if failed gid 0 then alert
	if failed perm 0600 then alert

check file login.conf path /etc/login.conf
	if failed uid 0 then alert
	if failed gid 0 then alert
	if failed perm 0600 then alert
	if failed md5 checksum expect 320470b305616d023fb659a344ffe44b then alert

check file letsencrypt.pem path /etc/acme/letsencrypt.pem
	if failed uid 0 then alert
	if failed gid 0 then alert
	if failed perm 0400 then alert
	if failed md5 checksum expect 372a374ad0a13ab7129e7dde425d8403 then alert

check file usr/bin/login path /usr/bin/login
	if failed uid 0 then alert
	if failed gid 7 then alert
	if failed perm 555 then alert
	if failed md5 checksum expect 6c620a854ed0a13a91ebdbd53818d637 then alert

check file usr/sbin/sshd path /usr/sbin/sshd
	if failed uid 0 then alert
	if failed gid 7 then alert
	if failed perm 0511 then alert
	if failed md5 checksum expect 19676b5cac6bdf6e27ce0205af2a8ba9 then alert

check file usr/bin/su path /usr/bin/su
	if failed uid 0 then alert
	if failed gid 7 then alert
	if failed perm 4555 then alert
	if failed md5 checksum expect d5f107f4bcf7796de6c097952dab48da then alert

check file script/bliptown path /usr/local/www/bliptown/script/bliptown
	if failed uid 0 then alert
	if failed gid 1002 then alert
	if failed perm 0750 then alert

check file script/bliptown_helper path /usr/local/www/bliptown/script/bliptown_helper
	if failed uid 0 then alert
	if failed gid 1002 then alert
	if failed perm 0750 then alert
	if failed md5 checksum expect e18b9132c6b8688be63960abcd7c6cff then alert

check file users.db path /var/db/bliptown/users.db
	if failed uid 1002 then alert
	if failed gid 1002 then alert
	if failed perm 0600 then alert

check directory usr/local/www/bliptown path /usr/local/www/bliptown
	if failed uid 0 then alert
	if failed gid 1002 then alert
	if failed perm 0755 then alert

check directory etc/ssl/private path /etc/ssl/private
	if failed uid 0 then alert
	if failed gid 0 then alert
	if failed perm 0700 then alert
