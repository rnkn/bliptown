#!/bin/sh

logfile=/var/log/relayd

grep \.php < "$logfile" |
	sed -nE 's/.*([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}) ->.*/\1/p' |
	while read ip
	do pfctl -t rate_limit -T add "$ip"
	done
