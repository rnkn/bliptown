<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title><%= $title %></title>
		<link href="/main.css" rel="stylesheet">
		<link href="/style.css" rel="stylesheet">
		%== $head
	</head>
	<body>
		<input type="radio" id="drawer-switch-login" name="drawer-switch" hidden>
		<input type="radio" id="drawer-switch-join" name="drawer-switch" hidden checked>
		<div id="drawer">
			% if (session('username')) {
			<div id="user" class="panel">
				% if (session('username') eq get_domain_user) {
				<div class="button"><a href="<%= url_for('new_page', catchall => '')->query(back_to => $redirect) %>">New</a></div>
				% if ($editable && $redirect) {
				<div class="button"><a href="<%= url_for('edit_page')->query(back_to => $redirect) %>">Edit</a></div>
				% } elsif ($editable) {
				<div class="button"><a href="<%= url_for('edit_page') %>">Edit</a></div>
				% }
				<div class="button"><a href="<%= url_for('list_files') %>">All Files</a></div>
				<div class="button"><a href="/style">Style</a></div>
				<div class="button"><a href="<%= url_for('list_settings') %>">Settings</a></div>
				% } else {
				<div class="button"><a href="<%= $home %>" id="my-site">My Site</a></div>
				% }
				<div class="button"><a href="<%= url_for('user_logout') %>">Log Out</a></div>
			</div>
			% } else {
			% if ($show_join) {
			<div id="join" class="panel">
				<form method="POST" action="<%= url_for('user_join') %>">
					<div class="input">
						<label for="join-username">Username</label>
						<input type="text" placeholder="[a-zA-Z][a-zA-Z0-9_-]*" pattern="[a-zA-Z][a-zA-Z0-9_\-]*" id="join-username" name="username" maxlength="31" required>
					</div>
					<div class="input">
						<label for="join-email">Email</label>
						<input type="email" id="join-email" name="email" maxlength="254" required>
					</div>
					<div class="input">
						<label for="join-password">Password</label>
						<input type="password" id="join-password" name="password" minlength="8" maxlength="256" required>
					</div>
					<input name="redirect-to" value="<%= url_for %>" hidden>
					<button type="submit">Join</button>
				</form>
				<div class="extras">
					<label id="drawer-switch-login" class="switch" for="drawer-switch-login">Login</label>
				</div>
			</div>
			% }
			<div id="login" class="panel">
				<form action="<%= url_for('user_login') %>" method="POST">
					<div>
						<label for="login-username">Username</label>
						<input type="text" id="login-username" name="username" required>
					</div>
					<div>
						<label for="login-password">Password</label>
						<input type="password" id="login-password" name="password" required>
					</div>
					<div>
						<label for="login-totp">2FA</label>
						<input type="text" id="login-totp" name="totp" required>
					</div>
					<input name="redirect-to" value="<%= url_for %>" hidden>
					<button type="submit">Login</button>
				</form>
				<div class="extras">
					% if ($show_join) {
					<label id="drawer-switch-join" class="switch" for="drawer-switch-join">Join</label>
					% }
				</div>
			</div>
			% }
		</div>
		<input type="checkbox" id="drawer-toggle" hidden>
		<div id="viewport">
			<label id="drawer-toggle" class="button" for="drawer-toggle"></label>
			%= content
		</div>
		% my $message = begin
		% my $type = shift;
		<input type="checkbox" id="message-close" hidden checked>
		<label id="message-close" class="button" for="message-close">
			<div id="message" class="<%= $type %>">
				<p><%= flash("$type") %></p>
			</div>
		</label>
		% end
		% if (flash('warning')) {
		%= $message->('warning')
		% } elsif (flash('info')) {
		%= $message->('info')
		% }
	</body>
</html>
